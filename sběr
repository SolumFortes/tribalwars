// ==UserScript==
// @name         Automatické farmaření ve hře Divoké Kmeny
// @namespace    http://tampermonkey.net/
// @version      1.7
// @description  Automatické farmaření s přirozenějšími intervaly pro lidské chování a cílením na správné tlačítko, s možností zapnutí/vypnutí
// @author       Tvé jméno
// @match        https://*.divokekmeny.cz/game.php*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    // Funkce pro spuštění skriptu pro hromadný sběr
    function startMassScavenge() {
        $.getScript('https://shinko-to-kuma.com/scripts/massScavenge.js')
            .done(function() {
                // Po načtení skriptu spustíme kontrolu a zaškrtnutí požadovaných tlačítek
                checkAndCheckFields();
                performRandomActions();  // Spustí provádění akcí v náhodných intervalech
                launchGroup1();  // Klikne na tlačítko "Launch group 1"
                scheduleNextRun();  // Nastaví opakování celého procesu za hodinu a 1 minutu
            })
            .fail(function() {
                console.error('Skript pro hromadný sběr se nepodařilo načíst.');
            });
    }

    // Funkce pro kontrolu a automatické zaškrtnutí požadovaných tlačítek
    function checkAndCheckFields() {
        const requiredCheckboxes = [
            document.getElementById('spear'),
            document.getElementById('sword'),
            document.getElementById('category1'),
            document.getElementById('category2'),
            document.getElementById('category3'),
            document.getElementById('category4')
        ];

        const requiredRadios = [
            document.getElementById('timeSelectorHours'),
            document.getElementById('settingPriorityBalanced')
        ];

        // Kontrola a automatické zaškrtnutí checkboxů
        for (let checkbox of requiredCheckboxes) {
            if (checkbox && !checkbox.checked) {
                checkbox.checked = true;  // Zaškrtne checkbox, pokud není zaškrtnutý
            }
        }

        // Kontrola a automatické zaškrtnutí rádiových tlačítek
        for (let radio of requiredRadios) {
            if (radio && !radio.checked) {
                radio.checked = true;  // Zaškrtne radio tlačítko, pokud není vybrané
            }
        }
    }

    // Funkce pro přepnutí stavu hromadného sběru
    function toggleMassScavenge() {
        premiumBtnEnabled = !premiumBtnEnabled;  // Přepne stav

        // Uložíme stav do localStorage
        localStorage.setItem('premiumBtnEnabled', premiumBtnEnabled);

        // Změna barvy a textu tlačítka podle stavu
        if (premiumBtnEnabled) {
            massScavengeButton.style.backgroundColor = 'green';
            massScavengeButton.innerText = 'MassScavenge - ON';
        } else {
            massScavengeButton.style.backgroundColor = 'red';
            massScavengeButton.innerText = 'MassScavenge - OFF';
        }
    }

    // Načtení stavu z localStorage, pokud je uložen
    let premiumBtnEnabled = localStorage.getItem('premiumBtnEnabled') === 'true';

    // Vytvoření tlačítka
    let massScavengeButton = document.createElement('button');
    massScavengeButton.innerText = premiumBtnEnabled ? 'MassScavenge - ON' : 'MassScavenge - OFF';
    massScavengeButton.style.position = 'fixed';
    massScavengeButton.style.left = '10px';  // Umístění 10px od levé strany
    massScavengeButton.style.top = '50%';  // Umístění uprostřed vertikálně (50% od horní části)
    massScavengeButton.style.transform = 'translateY(-50%)';  // Přesunutí tlačítka na přesný střed
    massScavengeButton.style.padding = '10px';
    massScavengeButton.style.border = 'none';
    massScavengeButton.style.color = 'white';
    massScavengeButton.style.cursor = 'pointer';
    massScavengeButton.style.zIndex = '1000';
    massScavengeButton.style.borderRadius = '5px';
    massScavengeButton.style.backgroundColor = premiumBtnEnabled ? 'green' : 'red';

    // Připojení tlačítka na stránku
    document.body.appendChild(massScavengeButton);

    // Přidání event listeneru pro přepnutí stavu
    massScavengeButton.addEventListener('click', toggleMassScavenge);

    // Pokud je hromadný sběr zapnutý, spustí skript
    if (premiumBtnEnabled) {
        $.getScript('https://shinko-to-kuma.com/scripts/massScavenge.js');  // Načte skript pro hromadný sběr
    }

    // Nejprve spustíme hromadný sběr, jakmile se načte stránka
    startMassScavenge();

    // Funkce pro provádění náhodných akcí (změna hodnot a kliknutí)
    function performRandomActions() {
        // Čekáme náhodný čas (interval) a provedeme přepis hodnot
        setTimeout(function() {
            // Změníme hodnotu textového pole s třídou runTime_off na 1
            let runTimeOff = document.querySelector('.runTime_off');
            if (runTimeOff) {
                runTimeOff.value = '1';  // Přepíšeme hodnotu na 1
            }

            // Změníme hodnotu textového pole s třídou runTime_def na 1
            let runTimeDef = document.querySelector('.runTime_def');
            if (runTimeDef) {
                runTimeDef.value = '1';  // Přepíšeme hodnotu na 1
            }

            // Klikneme na tlačítko pro výpočet běhů
            let sendMassButton = document.getElementById('sendMass');
            if (sendMassButton) {
                sendMassButton.click();  // Simulujeme kliknutí na tlačítko
            }

        }, getRandomInt(2000, 5000));  // Čekáme náhodně mezi 2 a 5 sekundami

    }

    // Funkce pro generování náhodného čísla v daném rozsahu
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // Funkce pro kliknutí na tlačítko pro spuštění skupiny 1
    function launchGroup1() {
        const launchButton = document.getElementById('sendMass');
        if (launchButton) {
            launchButton.click();  // Klikne na tlačítko "Launch group 1"
        }
    }

    // Funkce pro naplánování opakování procesu
    function scheduleNextRun() {
        setTimeout(function() {
            startMassScavenge();  // Opakujeme celý proces po hodině a jedné minutě (3660 sekund)
        }, 3660000);  // 3660 sekund = 1 hodina + 1 minuta
    }

})();
